<div class="dialog-container">
  <h2 mat-dialog-title>
    <mat-icon>{{ isEdit ? 'edit' : 'add' }}</mat-icon>
    {{ isEdit ? 'Editar Producto' : 'Nuevo Producto' }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="productForm" class="product-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre del Producto *</mat-label>
          <input matInput 
                 formControlName="name" 
                 placeholder="Ingrese el nombre del producto">
          <mat-error *ngIf="productForm.get('name')?.hasError('required')">
            El nombre es requerido
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>SKU *</mat-label>
          <input matInput 
                 formControlName="sku" 
                 placeholder="Código SKU">
          <mat-error *ngIf="productForm.get('sku')?.hasError('required')">
            El SKU es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Código de Barras</mat-label>
          <input matInput 
                 formControlName="barcode" 
                 placeholder="Código de barras (opcional)">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descripción</mat-label>
          <textarea matInput 
                    formControlName="description" 
                    placeholder="Descripción del producto"
                    rows="3"></textarea>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Categoría *</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category.name">
              {{ category.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productForm.get('category')?.hasError('required')">
            La categoría es requerida
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Marca *</mat-label>
          <input matInput 
                 formControlName="brand" 
                 placeholder="Marca del producto">
          <mat-error *ngIf="productForm.get('brand')?.hasError('required')">
            La marca es requerida
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Precio de Venta *</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="price" 
                 placeholder="0.00"
                 min="0"
                 step="0.01">
          <span matPrefix>$&nbsp;</span>
          <mat-error *ngIf="productForm.get('price')?.hasError('required')">
            El precio es requerido
          </mat-error>
          <mat-error *ngIf="productForm.get('price')?.hasError('min')">
            El precio debe ser mayor a 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Costo *</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="cost" 
                 placeholder="0.00"
                 min="0"
                 step="0.01">
          <span matPrefix>$&nbsp;</span>
          <mat-error *ngIf="productForm.get('cost')?.hasError('required')">
            El costo es requerido
          </mat-error>
          <mat-error *ngIf="productForm.get('cost')?.hasError('min')">
            El costo debe ser mayor a 0
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="quarter-width">
          <mat-label>Stock Actual *</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="stock" 
                 placeholder="0"
                 min="0">
          <mat-error *ngIf="productForm.get('stock')?.hasError('required')">
            El stock es requerido
          </mat-error>
          <mat-error *ngIf="productForm.get('stock')?.hasError('min')">
            El stock debe ser mayor o igual a 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="quarter-width">
          <mat-label>Stock Mínimo *</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="minStock" 
                 placeholder="0"
                 min="0">
          <mat-error *ngIf="productForm.get('minStock')?.hasError('required')">
            El stock mínimo es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="quarter-width">
          <mat-label>Stock Máximo *</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="maxStock" 
                 placeholder="0"
                 min="0">
          <mat-error *ngIf="productForm.get('maxStock')?.hasError('required')">
            El stock máximo es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="quarter-width">
          <mat-label>Unidad *</mat-label>
          <input matInput 
                 formControlName="unit" 
                 placeholder="unidad">
          <mat-error *ngIf="productForm.get('unit')?.hasError('required')">
            La unidad es requerida
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>URL de Imagen</mat-label>
          <input matInput 
                 formControlName="imageUrl" 
                 placeholder="https://ejemplo.com/imagen.jpg">
        </mat-form-field>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" type="button">
      Cancelar
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSave()" 
            [disabled]="productForm.invalid || isLoading"
            type="button">
      <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
      {{ isLoading ? 'Guardando...' : (isEdit ? 'Actualizar' : 'Crear') }}
    </button>
  </mat-dialog-actions>
</div>